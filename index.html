<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Agendaku</title>
  <!-- Prevent cache -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* CSS tidak ada perubahan dari revisi sebelumnya */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap');
    body {
      background-image: var(--bg-image-url, url('media/bg.jpg'));
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
      overflow: hidden;
      min-height: 100vh;
      min-width: 320px;
      font-family: 'Poppins', sans-serif;
      transition: background-image 0.5s ease-in-out;
    }
    .overlay {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }
    #menu.overlay {
        overflow-y: auto;
    }
    .slide {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(255,255,255,0.97);
      padding: 20px;
      display: none;
      flex-direction: column;
      opacity: 0;
      transform: translateX(100%);
      transition: opacity 0.4s ease-out, transform 0.4s ease-out;
      overflow-y: auto;
      z-index: 10;
      box-shadow: -5px 0 15px rgba(0,0,0,0.2);
    }
    .slide.active {
      display: flex;
      opacity: 1;
      transform: translateX(0);
    }
    .slide:not(.active) {
      transform: translateX(-20%) scale(0.95);
      opacity: 0;
    }
    input[type="text"], select, input[type="time"] {
      padding: 12px 16px;
      border: 2px solid #ccc;
      border-radius: 10px;
      font-size: 20px;
      width: min(90%, 400px);
      margin-bottom: 20px;
      background: rgba(255,255,255,0.9);
      transition: all 0.3s;
    }
    .btn {
      padding: 15px 30px;
      margin: 10px;
      border: none;
      border-radius: 25px;
      font-size: 18px;
      cursor: pointer;
      width: min(90%, 400px);
      min-width: 200px;
      background: linear-gradient(45deg, #00c853, #2962ff);
      color: white;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, background 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      background: linear-gradient(45deg, #00e676, #3f51b5);
    }
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .btn-danger {
      background: linear-gradient(45deg, #f44336, #d32f2f);
    }
    .btn-danger:hover {
      background: linear-gradient(45deg, #f56565, #e53e3e);
    }
    .btn-warning {
      background: linear-gradient(45deg, #ff9800, #f57c00);
    }
    .btn-warning:hover {
      background: linear-gradient(45deg, #ffb74d, #fb8c00);
    }
    .btn-info {
      background: linear-gradient(45deg, #2196f3, #1976d2);
    }
    .btn-info:hover {
      background: linear-gradient(45deg, #42a5f5, #1e88e5);
    }
    .btn-success {
      background: linear-gradient(45deg, #4caf50, #388e3c);
    }
    .btn-success:hover {
      background: linear-gradient(45deg, #66bb6a, #43a047);
    }
    #tombol-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
      width: 100%;
    }
    .tombol-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      width: 100%;
    }
    .tombol-row .btn {
      flex: 1 1 calc(50% - 7.5px);
      min-width: 200px;
      max-width: 300px;
    }
    @media (max-width: 600px) {
      .tombol-row .btn {
        flex: 1 1 100%;
        min-width: 280px;
      }
    }
    .time-row {
      display: flex;
      gap: 15px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .time-input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .time-input-group label {
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }
    .time-input-group input[type="time"] {
      width: 140px;
      margin-bottom: 0;
    }
    @media (max-width: 500px) {
      .time-row {
        flex-direction: column;
        gap: 20px;
      }
    }
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23666' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
      background-repeat: no-repeat;
      background-position: right 16px center;
      background-size: 12px;
    }
    select:focus, input[type="text"]:focus, input[type="time"]:focus {
      border-color: #2962ff;
      outline: none;
      box-shadow: 0 0 0 3px rgba(41, 98, 255, 0.1);
    }
    .back-button {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      transition: all 0.3s;
    }
    .back-button:hover {
      background: rgba(0,0,0,0.9);
      transform: scale(1.1);
    }
    .title-with-back {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      width: 100%;
      max-width: 800px;
    }
    .title-with-back h1 {
      color: #333;
      font-size: 28px;
      font-weight: 600;
      margin: 0 auto;
      text-align: center;
      flex: 1;
    }
    .title-with-back .back-btn-inline {
      background: rgba(0,0,0,0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }
    .title-with-back .back-btn-inline:hover {
      background: rgba(0,0,0,0.9);
      transform: scale(1.1);
    }
    .branding {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(45deg, #2962ff, #00c853);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: all 0.3s;
      z-index: 100;
    }
    .branding:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
      text-align: center;
    }
    .topic-card {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-left: 5px solid #2962ff;
      transition: all 0.3s;
    }
    .topic-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.2);
    }
    .topic-card h3 {
      color: #2962ff;
      margin-bottom: 15px;
      font-size: 20px;
      font-weight: 600;
    }
    .topic-card .description {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
      font-size: 16px;
    }
    .topic-card .time-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: 14px;
      color: #888;
    }
    .topic-card .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .topic-card .btn-small {
      padding: 8px 16px;
      font-size: 14px;
      min-width: auto;
      width: auto;
      flex: none;
    }
    .error-message {
      background: linear-gradient(45deg, #f44336, #d32f2f);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    }
    .success-message {
      background: linear-gradient(45deg, #4caf50, #388e3c);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    .warning-message {
      background: linear-gradient(45deg, #ff9800, #f57c00);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }
    .agenda-day {
      background: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      border-left: 4px solid #2962ff;
    }
    .agenda-day h3 {
      color: #2962ff;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .agenda-day h3::before {
      content: "📅";
      font-size: 20px;
    }
    .agenda-item {
      background: rgba(249,249,249,0.8);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      border-left: 3px solid #00c853;
    }
    .agenda-item:last-child {
      margin-bottom: 0;
    }
    .agenda-item .time {
      font-weight: 600;
      color: #2962ff;
      font-size: 14px;
    }
    .agenda-item .activity {
      color: #333;
      margin-top: 5px;
      font-size: 16px;
    }
    .week-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      background: rgba(255,255,255,0.9);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .week-navigation button {
      background: linear-gradient(45deg, #2962ff, #1976d2);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      min-width: auto;
      width: auto;
    }
    .week-navigation button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(41, 98, 255, 0.3);
    }
    .week-navigation .week-info {
      text-align: center;
      font-weight: 600;
      color: #333;
      font-size: 16px;
    }
    .empty-agenda {
      text-align: center;
      color: #888;
      font-style: italic;
      padding: 40px 20px;
      background: rgba(255,255,255,0.7);
      border-radius: 15px;
      margin: 20px 0;
    }
    .empty-agenda::before {
      content: "📝";
      display: block;
      font-size: 48px;
      margin-bottom: 15px;
    }
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .topic-card, .agenda-day {
      animation: slideInUp 0.5s ease-out;
    }
    /* Loading animation */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    /* Responsive improvements */
    @media (max-width: 768px) {
      .overlay {
        padding: 15px;
      }
      h1 {
        font-size: 24px;
      }
      .topic-card, .agenda-day {
        padding: 20px;
        margin-bottom: 20px;
      }
      .week-navigation {
        flex-direction: column;
        gap: 15px;
      }
      .week-navigation .week-info {
        order: -1;
      }
    }
    @media (max-width: 480px) {
      .overlay {
        padding: 10px;
      }
      .branding {
        top: 10px;
        right: 10px;
        padding: 8px 15px;
        font-size: 14px;
      }
      .back-button {
        top: 10px;
        left: 10px;
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      .title-with-back .back-btn-inline {
        width: 35px;
        height: 35px;
        font-size: 18px;
      }
    }
    /* Popup Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .popup-overlay.active {
      display: flex;
      opacity: 1;
    }
    .popup {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }
    .popup-overlay.active .popup {
      transform: scale(1);
    }
    .popup h2 {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
    }
    .popup .close-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #666;
      transition: color 0.3s;
    }
    .popup .close-btn:hover {
      color: #f44336;
    }
    /* Image selector styles */
    .image-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .image-selector img {
      width: 100%;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      border: 3px solid transparent;
    }
    .image-selector img:hover {
      transform: scale(1.05);
      border-color: #2962ff;
      box-shadow: 0 4px 15px rgba(41, 98, 255, 0.3);
    }
    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(45deg, #4caf50, #388e3c);
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 10000;
      font-weight: 600;
    }
    .toast.show {
      transform: translateX(0);
    }
    .toast.error {
      background: linear-gradient(45deg, #f44336, #d32f2f);
    }
    .toast.warning {
      background: linear-gradient(45deg, #ff9800, #f57c00);
    }
    .toast.info {
      background: linear-gradient(45deg, #2196f3, #1976d2);
    }
    /* PDF Export Popup */
    .pdf-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin: 20px 0;
    }
    .pdf-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .pdf-option:hover {
      border-color: #2962ff;
      background: rgba(41, 98, 255, 0.05);
    }
    .pdf-option input[type="radio"] {
      margin: 0;
      width: auto;
      transform: scale(1.2);
    }
    .pdf-option label {
      cursor: pointer;
      font-weight: 500;
      margin: 0;
    }
    /* Tutorial overlay */
    .tutorial-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .tutorial-overlay.active {
      display: flex;
      opacity: 1;
    }
    .tutorial-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      text-align: center;
    }
    .tutorial-content h2 {
      color: #2962ff;
      margin-bottom: 20px;
      font-size: 28px;
    }
    .tutorial-content p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
      font-size: 16px;
    }
    .tutorial-step {
      background: rgba(41, 98, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 15px 0;
      border-left: 4px solid #2962ff;
    }
    .tutorial-step h3 {
      color: #2962ff;
      margin-bottom: 10px;
      font-size: 18px;
    }
    .tutorial-step p {
      margin: 0;
      color: #555;
      font-size: 14px;
    }
    /* Sidebar specific styles */
    #agendakuSidebar {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0;
      box-shadow: -5px 0 15px rgba(0,0,0,0.3);
      transition: right 0.4s ease;
      z-index: 1001;
      overflow-y: auto;
    }
    #agendakuSidebar.active {
      right: 0;
    }
    .sidebar-overlay-blur {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .sidebar-overlay-blur.active {
      opacity: 1;
      visibility: visible;
    }
    #agendakuSidebar .sidebar-header h3,
    #agendakuSidebar .sidebar-content,
    #agendakuSidebar .sidebar-footer {
      padding-left: 20px;
      padding-right: 20px;
    }
    #agendakuSidebar .sidebar-header {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    #agendakuSidebar .sidebar-header h3 {
      margin: 0;
      font-size: 20px;
      padding: 0;
    }
    #agendakuSidebar .sidebar-close-btn {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      transition: transform 0.2s;
    }
    #agendakuSidebar .sidebar-close-btn:hover {
      transform: scale(1.1);
    }
    #agendakuSidebar .sidebar-content h4 {
      color: rgba(255, 255, 255, 0.9);
      margin: 20px 0 15px 0;
      font-size: 16px;
    }
    #agendakuSidebar .sidebar-footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      text-align: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }
    #agendakuSidebar .sidebar-content {
      padding-bottom: 80px;
    }
    #agendakuSidebar .sidebar-content p {
      line-height: 1.6;
      margin-bottom: 15px;
      color: rgba(255, 255, 255, 0.9);
      font-size: 14px;
    }
    /* Social icons in sidebar */
    .social-icons-container {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 25px 0;
      padding: 0 20px;
    }
    .social-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: all 0.3s;
      color: white;
    }
    .social-icon:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    .social-icon svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }
    .btn-keluar-sidebar {
      background: linear-gradient(45deg, #f44336, #d32f2f);
      color: white;
      border: none;
      border-radius: 25px;
      padding: 12px 30px;
      margin: 20px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      width: calc(100% - 40px);
      box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
      transition: all 0.3s;
    }
    .btn-keluar-sidebar:hover {
      background: linear-gradient(45deg, #f56565, #e53e3e);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(244, 67, 54, 0.4);
    }
    /* Import/Export styles */
    .import-export-section {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    .import-export-section h4 {
      color: white;
      margin-bottom: 15px;
      font-size: 16px;
      text-align: center;
    }
    .sidebar-action-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
    }
    .btn-sidebar-action {
      background: linear-gradient(45deg, #00c853, #388e3c);
      color: white;
      border: none;
      border-radius: 20px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .btn-sidebar-action:hover {
      background: linear-gradient(45deg, #00e676, #43a047);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 200, 83, 0.3);
    }
    /* Responsive sidebar */
    @media (max-width: 480px) {
      #agendakuSidebar {
        width: 100%;
        right: -100%;
      }
    }
    /* Welcome Popup Styles */
    .welcome-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 3000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .welcome-popup.active {
      opacity: 1;
      visibility: visible;
    }
    .welcome-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 25px;
      padding: 40px;
      max-width: 90%;
      max-height: 90%;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
      text-align: center;
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }
    .welcome-popup.active .welcome-content {
      transform: scale(1);
    }
    .welcome-content h1 {
      color: white;
      font-size: 32px;
      margin-bottom: 20px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .welcome-content p {
      font-size: 18px;
      line-height: 1.6;
      margin-bottom: 30px;
      color: rgba(255, 255, 255, 0.9);
    }
    .welcome-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    .welcome-feature {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      transition: transform 0.3s;
    }
    .welcome-feature:hover {
      transform: translateY(-5px);
    }
    .welcome-feature .feature-icon {
      font-size: 40px;
      margin-bottom: 15px;
      display: block;
    }
    .welcome-feature h3 {
      color: white;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .welcome-feature p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      margin: 0;
      line-height: 1.5;
    }
    .welcome-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    .btn-welcome {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      padding: 15px 30px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s;
      min-width: 140px;
    }
    .btn-welcome:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
    }
    .btn-welcome.primary {
      background: #00c853;
      border-color: #00c853;
    }
    .btn-welcome.primary:hover {
      background: #00e676;
      border-color: #00e676;
    }
    /* Responsive welcome popup */
    @media (max-width: 768px) {
      .welcome-content {
        padding: 30px 20px;
      }
      .welcome-content h1 {
        font-size: 28px;
      }
      .welcome-content p {
        font-size: 16px;
      }
      .welcome-features {
        grid-template-columns: 1fr;
      }
      .welcome-actions {
        flex-direction: column;
        align-items: center;
      }
      .btn-welcome {
        width: 100%;
        max-width: 300px;
      }
    }
  </style>
</head>
<body>

  <!-- Welcome Popup -->
  <div id="welcomePopup" class="welcome-popup">
    <div class="welcome-content">
      <h1>🎉 Selamat Datang di Agendaku!</h1>
      <p>Aplikasi manajemen agenda terbaik untuk membantu Anda mengatur jadwal harian dengan lebih efisien dan terorganisir.</p>
      
      <div class="welcome-features">
        <div class="welcome-feature">
          <span class="feature-icon">📅</span>
          <h3>Kelola Jadwal</h3>
          <p>Buat dan atur jadwal harian dengan mudah</p>
        </div>
        <div class="welcome-feature">
          <span class="feature-icon">🎨</span>
          <h3>Kustomisasi Tema</h3>
          <p>Pilih latar belakang sesuai selera Anda</p>
        </div>
        <div class="welcome-feature">
          <span class="feature-icon">📱</span>
          <h3>Notifikasi</h3>
          <p>Dapatkan pengingat untuk agenda penting</p>
        </div>
        <div class="welcome-feature">
          <span class="feature-icon">📄</span>
          <h3>Export PDF</h3>
          <p>Simpan agenda dalam format PDF</p>
        </div>
      </div>
      
      <div class="welcome-actions">
        <button class="btn-welcome" onclick="showTutorial()">📖 Lihat Tutorial</button>
        <button class="btn-welcome primary" onclick="closeWelcome()">✨ Mulai Sekarang</button>
      </div>
    </div>
  </div>

  <!-- Tutorial Overlay -->
  <div id="tutorialOverlay" class="tutorial-overlay">
    <div class="tutorial-content">
      <button class="close-btn" onclick="closeTutorial()">&times;</button>
      <h2>📚 Panduan Penggunaan Agendaku</h2>
      <p>Ikuti langkah-langkah berikut untuk memaksimalkan penggunaan aplikasi Agendaku:</p>
      
      <div class="tutorial-step">
        <h3>1. 📝 Membuat Agenda Baru</h3>
        <p>Klik tombol "Buat Agenda" di halaman utama, lalu isi topik, deskripsi, dan waktu agenda Anda.</p>
      </div>
      
      <div class="tutorial-step">
        <h3>2. 👀 Melihat Jadwal</h3>
        <p>Gunakan tombol "Lihat Jadwal" untuk melihat semua agenda yang telah Anda buat. Navigasi antar minggu dengan tombol panah.</p>
      </div>
      
      <div class="tutorial-step">
        <h3>3. 🎨 Mengganti Tema</h3>
        <p>Klik tombol "Ganti Tema" untuk memilih latar belakang yang sesuai dengan mood Anda.</p>
      </div>
      
      <div class="tutorial-step">
        <h3>4. 📱 Mengatur Notifikasi</h3>
        <p>Aktifkan notifikasi melalui sidebar untuk mendapatkan pengingat agenda penting.</p>
      </div>
      
      <div class="tutorial-step">
        <h3>5. 📄 Export ke PDF</h3>
        <p>Simpan agenda Anda dalam format PDF melalui sidebar untuk dibagikan atau dicetak.</p>
      </div>
      
      <div class="tutorial-step">
        <h3>6. 💾 Backup & Restore</h3>
        <p>Gunakan fitur Export/Import Project di sidebar untuk backup data agenda Anda.</p>
      </div>
      
      <button class="btn btn-success" onclick="closeTutorial()">Mengerti, Tutup Tutorial</button>
    </div>
  </div>

  <!-- Sidebar overlay blur -->
  <div class="sidebar-overlay-blur" id="sidebarOverlay"></div>

  <!-- HALAMAN UTAMA -->
  <div id="menu" class="overlay">
    <button class="branding" onclick="openAgendakuBranding()">Agendaku ✨</button>
    
    <h1>🎯 Agendaku - Kelola Jadwal Anda</h1>
    
    <div id="tombol-container">
      <div class="tombol-row">
        <button class="btn btn-success" onclick="showSlide('buatAgenda')">📝 Buat Agenda</button>
        <button class="btn btn-info" onclick="showSlide('lihatJadwal')">👀 Lihat Jadwal</button>
      </div>
      <div class="tombol-row">
        <button class="btn btn-warning" onclick="showImageSelector()">🎨 Ganti Tema</button>
        <button class="btn btn-info" onclick="showTutorial()">📚 Tutorial</button>
      </div>
    </div>
  </div>

  <!-- SLIDE: BUAT AGENDA -->
  <div id="buatAgenda" class="slide">
    <div class="title-with-back">
      <button class="back-btn-inline" onclick="hideSlide('buatAgenda')">&larr;</button>
      <h1>📝 Buat Agenda Baru</h1>
    </div>
    
    <input type="text" id="topik" placeholder="Masukkan topik agenda..." />
    <input type="text" id="deskripsi" placeholder="Deskripsi agenda (opsional)..." />
    
    <div class="time-row">
      <div class="time-input-group">
        <label for="waktuMulai">Waktu Mulai</label>
        <input type="time" id="waktuMulai" />
      </div>
      <div class="time-input-group">
        <label for="waktuSelesai">Waktu Selesai</label>
        <input type="time" id="waktuSelesai" />
      </div>
    </div>
    
    <select id="hari">
      <option value="">Pilih hari...</option>
      <option value="Senin">Senin</option>
      <option value="Selasa">Selasa</option>
      <option value="Rabu">Rabu</option>
      <option value="Kamis">Kamis</option>
      <option value="Jumat">Jumat</option>
      <option value="Sabtu">Sabtu</option>
      <option value="Minggu">Minggu</option>
    </select>
    
    <button class="btn btn-success" onclick="tambahAgenda()">✅ Tambah Agenda</button>
  </div>

  <!-- SLIDE: LIHAT JADWAL -->
  <div id="lihatJadwal" class="slide">
    <div class="title-with-back">
      <button class="back-btn-inline" onclick="hideSlide('lihatJadwal')">&larr;</button>
      <h1>📅 Jadwal Mingguan</h1>
    </div>
    
    <div class="week-navigation">
      <button onclick="navigateWeek(-1)">👈 Minggu Sebelumnya</button>
      <div class="week-info">
        <div id="currentWeekInfo">Minggu ini</div>
      </div>
      <button onclick="navigateWeek(1)">Minggu Selanjutnya 👉</button>
    </div>
    
    <div class="jadwal-section">
      <div id="jadwal-container">
        <!-- Jadwal akan dimuat di sini -->
      </div>
    </div>
  </div>

  <!-- Image Selector Popup -->
  <div id="imagePopup" class="popup-overlay">
    <div class="popup">
      <button class="close-btn" onclick="closeImageSelector()">&times;</button>
      <h2>🎨 Pilih Latar Belakang</h2>
      <p>Klik pada gambar untuk melihat preview, lalu konfirmasi pilihan Anda:</p>
      <div class="image-selector">
        <img src="media/tema1.jpg" onclick="confirmImageTheme('media/tema1.jpg')" alt="Latar 1" />
        <img src="media/tema2.jpg" onclick="confirmImageTheme('media/tema2.jpg')" alt="Latar 2" />
        <img src="media/tema3.jpg" onclick="confirmImageTheme('media/tema3.jpg')" alt="Latar 3" />
        <img src="media/tema4.jpg" onclick="confirmImageTheme('media/tema4.jpg')" alt="Latar 4" />
        <img src="media/tema5.jpg" onclick="confirmImageTheme('media/tema5.jpg')" alt="Latar 5" />
        <img src="media/tema6.jpg" onclick="confirmImageTheme('media/tema6.jpg')" alt="Latar 6" />
        <img src="media/tema7.jpg" onclick="confirmImageTheme('media/tema7.jpg')" alt="Latar 7" />
        <img src="media/tema8.jpg" onclick="confirmImageTheme('media/tema8.jpg')" alt="Latar 8" />
        <img src="media/tema9.jpg" onclick="confirmImageTheme('media/tema9.jpg')" alt="Latar 9" />
        <img src="media/tema10.jpg" onclick="confirmImageTheme('media/tema10.jpg')" alt="Latar 10" />
      </div>
    </div>
  </div>

  <!-- Confirmation Popup -->
  <div id="confirmPopup" class="popup-overlay">
    <div class="popup">
      <h2>🖼️ Konfirmasi Tema</h2>
      <p>Apakah Anda yakin ingin menggunakan tema ini?</p>
      <div style="text-align: center; margin: 20px 0;">
        <img id="previewImage" src="" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 10px;" />
      </div>
      <div style="display: flex; gap: 15px; justify-content: center;">
        <button class="btn btn-success" onclick="applyImageTheme()">✅ Ya, Gunakan</button>
        <button class="btn btn-danger" onclick="cancelImageTheme()">❌ Batal</button>
      </div>
    </div>
  </div>

  <!-- PDF Export Popup -->
  <div id="pdfPopup" class="popup-overlay">
    <div class="popup">
      <button class="close-btn" onclick="closePdfPopup()">&times;</button>
      <h2>📄 Export ke PDF</h2>
      <p>Pilih jenis export yang Anda inginkan:</p>
      <div class="pdf-options">
        <div class="pdf-option" onclick="selectPdfOption('current')">
          <input type="radio" name="pdfType" value="current" id="currentWeek" />
          <label for="currentWeek">📅 Minggu Ini Saja</label>
        </div>
        <div class="pdf-option" onclick="selectPdfOption('all')">
          <input type="radio" name="pdfType" value="all" id="allWeeks" />
          <label for="allWeeks">📚 Semua Agenda</label>
        </div>
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-success" onclick="cekKoneksiUntukFitur(() => exportToPDF())">📄 Export Sekarang</button>
        <button class="btn btn-danger" onclick="closePdfPopup()">❌ Batal</button>
      </div>
    </div>
  </div>

  <!-- Exit Confirmation Popup -->
  <div id="exitPopup" class="popup-overlay">
    <div class="popup">
      <h2>🚪 Keluar Aplikasi</h2>
      <p>Apakah Anda yakin ingin keluar dari aplikasi?</p>
      <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
        <button class="btn btn-danger" onclick="exitApp()">✅ Ya, Keluar</button>
        <button class="btn btn-success" onclick="closeExitPopup()">❌ Batal</button>
      </div>
    </div>
  </div>

  <!-- Export Project Popup -->
  <div id="exportPopup" class="popup-overlay">
    <div class="popup">
      <button class="close-btn" onclick="closeExportPopup()">&times;</button>
      <h2>📤 Export Project</h2>
      <p>Export semua data agenda Anda untuk backup atau transfer ke perangkat lain.</p>
      <div style="text-align: center; margin: 20px 0;">
        <button class="btn btn-success" onclick="exportProject()">📁 Download File Backup</button>
        <button class="btn btn-danger" onclick="closeExportPopup()">❌ Batal</button>
      </div>
    </div>
  </div>

  <!-- Import Project Popup -->
  <div id="importPopup" class="popup-overlay">
    <div class="popup">
      <button class="close-btn" onclick="closeImportPopup()">&times;</button>
      <h2>📥 Import Project</h2>
      <p>Pilih file backup untuk mengimpor data agenda sebelumnya.</p>
      <div style="text-align: center; margin: 20px 0;">
        <input type="file" id="importFile" accept=".json" style="margin-bottom: 20px;" />
        <br />
        <button class="btn btn-success" onclick="importProject()">📁 Import Data</button>
        <button class="btn btn-danger" onclick="closeImportPopup()">❌ Batal</button>
      </div>
    </div>
  </div>

  <!-- Agendaku Sidebar -->
  <div id="agendakuSidebar">
    <div class="sidebar-header">
      <h3>✨ Agendaku</h3>
      <button class="sidebar-close-btn" onclick="closeAgendakuBranding()">&times;</button>
    </div>
    <div class="sidebar-content">
      <h4>🎯 Tentang Aplikasi</h4>
      <p>Agendaku adalah aplikasi manajemen jadwal yang membantu Anda mengorganisir aktivitas harian dengan lebih efisien dan terstruktur.</p>
      
      <h4>✨ Fitur Unggulan</h4>
      <p>• Kelola agenda harian dengan mudah<br>
      • Kustomisasi tema latar belakang<br>
      • Export agenda ke format PDF<br>
      • Backup dan restore data<br>
      • Notifikasi pengingat<br>
      • Interface yang user-friendly</p>

      <div class="sidebar-action-buttons">
          <button class="btn-sidebar-action" onclick="toggleNotifikasi()">
              🔔 Aktifkan / Nonaktifkan Notifikasi
          </button>
          <button class="btn-sidebar-action btn-new-update" onclick="cekKoneksiUntukFitur(() => openUpdateInBrowser())">
              🔥 Cek Update
          </button>
          <button class="btn-sidebar-action btn-export-project" onclick="showExportPopup()">
              📤 Export Project
          </button>
          <button class="btn-sidebar-action btn-import-project" onclick="showImportPopup()">
              📥 Import Project
          </button>
          <button class="btn-sidebar-action btn-export-pdf" onclick="cekKoneksiUntukFitur(() => showPdfConfirmPopup())">
              📄 Export ke PDF
          </button>
      </div>
    </div>
    
    <button class="btn-keluar-sidebar" onclick="showExitConfirmPopup()">Keluar</button>

    <div class="social-icons-container">
        <a href="javascript:void(0);" onclick="cekKoneksiUntukFitur(() => window.open('https://www.facebook.com/share/1XPb1Uti5i/', '_blank'))" class="social-icon" aria-label="Facebook">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 13.5h2.5L17 9h-3v-2c0-1.03 0-2 2-2h1.5V2.14c-.326-.053-1.6-.144-3.04-.144C10.66 2 9 3.65 9 6.7v2.8H6v4.5h3V22h5v-8.5z"/></svg>
        </a>
        <a href="javascript:void(0);" onclick="cekKoneksiUntukFitur(() => window.open('https://www.instagram.com/aminnu.s?igsh=dWV0bndhYmt6aDI1', '_blank'))" class="social-icon" aria-label="Instagram">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.8 2h8.4C19.4 2 22 4.6 22 7.8v8.4c0 3.2-2.6 5.8-5.8 5.8H7.8C4.6 22 2 19.4 2 16.2V7.8C2 4.6 4.6 2 7.8 2zm-.2 2A2.02 2.02 0 0 0 4 6.02V16.2C4 17.65 5.35 19 6.78 19h8.43c1.45 0 2.78-1.35 2.78-2.78V7.8c0-1.45-1.35-2.78-2.78-2.78H7.6zm9.6.48c-.9 0-1.62.73-1.62 1.62s.73 1.62 1.62 1.62c.9 0 1.62-.73 1.62-1.62s-.73-1.62-1.62-1.62zm-4.8 3.7c-2.48 0-4.5 2.02-4.5 4.5s2.02 4.5 4.5 4.5 4.5-2.02 4.5-4.5-2.02-4.5-4.5-4.5zm0 2.5c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/></svg>
        </a>
        <a href="javascript:void(0);" onclick="cekKoneksiUntukFitur(() => window.open('https://andikka0001.github.io/agendaku-komersial/', '_blank'))" class="social-icon" aria-label="Website">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v.93zm6.75-3.95c.23-.29.43-.58.62-.89l-1.3-.87c-.33.31-.69.64-1.08.96l1.76.8zm.51-1.28c.36-.59.69-1.2.98-1.84H14v-2h6.13c-.49-1.74-1.83-3.13-3.57-4.04l-1.76.99c.31.29.59.59.86.89l1.45-1.45L12 3.06V2.05c3.08.75 5.51 3.5 6 6.95h-2.1c-.5-1.34-1.49-2.43-2.77-3.14l1.83-1.83c1.7 2 2.77 4.58 2.77 7.42V12h-2.05c-.47-1.16-1.28-2.13-2.31-2.82L16.27 8.5C17.27 9.17 18.06 10.09 18.59 11.1H14V14h4.19c.1-.38.16-.76.16-1.15V12h2.05c-.45-3.08-2.61-5.59-5.38-6.15V3.06L12 2.05v1.01c-3.08.75-5.51 3.5-6 6.95h2.1c.5-1.34 1.49-2.43 2.77-3.14l-1.83-1.83C7.2 6.55 6.13 9.13 6.13 12v.85c.47 1.16 1.28 2.13 2.31 2.82l-1.84 1.84c-1.7-2-2.77-4.58-2.77-7.42V12H3.91C4.36 9.04 6.52 6.53 9.3 5.97V3.06L12 2.05z"/></svg>
        </a>
    </div>
    <div class="sidebar-footer">
        Versi 1.6
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Audio elements -->
  <audio id="toast-sound" src="media/notifikasi.mp3" preload="auto"></audio>
  <audio id="click-sound" src="media/klik.wav" preload="auto"></audio>

  <script>
    // === KONSTANTA & VARIABEL GLOBAL ===
    const DEFAULT_BACKGROUND_IMAGE = 'media/bg.jpg';
    let currentWeekOffset = 0;
    let selectedImageTheme = '';
    let selectedPdfType = '';

    // === DATA STORAGE ===
    function getAgendaData() {
      const saved = localStorage.getItem('agendaData');
      return saved ? JSON.parse(saved) : {};
    }

    function saveAgendaData(data) {
      localStorage.setItem('agendaData', JSON.stringify(data));
    }

    function getBackgroundImage() {
      return localStorage.getItem('backgroundImage') || DEFAULT_BACKGROUND_IMAGE;
    }

    function saveBackgroundImage(imageUrl) {
      localStorage.setItem('backgroundImage', imageUrl);
    }

    // === AUDIO FUNCTIONS ===
    function playToastSound() {
      const audio = document.getElementById('toast-sound');
      if (audio) {
        audio.currentTime = 0;
        audio.play().catch(e => console.log('Audio play failed:', e));
      }
    }

    function playClickSound() {
      const audio = document.getElementById('click-sound');
      if (audio) {
        audio.currentTime = 0;
        audio.play().catch(e => console.log('Audio play failed:', e));
      }
    }

    // === NOTIFICATION FUNCTIONS ===
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type}`;
      toast.classList.add('show');
      
      playToastSound();
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // --- TOGGLE NOTIFIKASI (AKTIF / NONAKTIF) ---
    function toggleNotifikasi() {
      if (typeof Android !== "undefined") {
        Android.toggleNotifikasi();
        // Tambahkan notifikasi sambutan setelah mengaktifkan notifikasi
        setTimeout(() => {
          if (typeof Android !== "undefined") {
            Android.showWelcomeNotification();
          }
        }, 1000);
      }
    }

    // --- PENJADWALAN NOTIFIKASI ---
    function aturNotifikasiJadwal(jam, pesan) {
      if (typeof Android !== "undefined") {
        Android.scheduleNotification(jam, pesan);
      }
    }

    // --- KONFIRMASI FITUR ONLINE: PDF, URL EKSTERNAL ---
    function cekKoneksiUntukFitur(callbackJikaOnline) {
      fetch("https://www.google.com", { mode: "no-cors" })
        .then(() => {
          if (confirm("Fitur ini memerlukan koneksi internet. Lanjutkan?")) {
            callbackJikaOnline();
          }
        })
        .catch(() => {
          alert("Koneksi tidak tersedia. Anda akan diarahkan ke halaman error.");
          window.location.href = "file:///android_asset/error.html";
        });
    }

    // Contoh penggunaan:
    // cekKoneksiUntukFitur(function() { window.open('https://linkmu.com', '_blank'); });

    window.onload = function() {
      cekKoneksiAwal(); // Jalankan verifikasi koneksi saat aplikasi dibuka
      
      // Set background image
      const savedBackground = getBackgroundImage();
      document.body.style.setProperty('--bg-image-url', `url('${savedBackground}')`);
      
      // Show welcome popup on first visit
      const hasVisited = localStorage.getItem('hasVisited');
      if (!hasVisited) {
        showWelcome();
        localStorage.setItem('hasVisited', 'true');
      }
      
      // Setup event listeners
      setupEventListeners();
      
      // Set contoh penjadwalan notifikasi
      aturNotifikasiJadwal("05:59", "Agenda Pagi akan dimulai");
      aturNotifikasiJadwal("12:00", "Saatnya istirahat makan siang");
      aturNotifikasiJadwal("17:00", "Agenda sore akan berakhir");
    };

    // === EVENT LISTENERS ===
    function setupEventListeners() {
      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          handleEscapeKey();
        }
      });
      
      // Click outside sidebar to close
      document.getElementById('sidebarOverlay').addEventListener('click', closeAgendakuBranding);
      
      // Input validation
      const timeInputs = document.querySelectorAll('input[type="time"]');
      timeInputs.forEach(input => {
        input.addEventListener('change', validateTimeInput);
      });
    }

    function handleEscapeKey() {
      const activePopup = document.querySelector('.popup-overlay.active, .tutorial-overlay.active, #agendakuSidebar.active');
      if (activePopup) {
        if (activePopup.id === 'agendakuSidebar') closeAgendakuBranding();
        else if (activePopup.classList.contains('tutorial-overlay')) closeTutorial();
        else if (activePopup.id === 'welcomePopup') closeWelcome();
        else closeAllPopups();
      }
    }

    function validateTimeInput(e) {
      const input = e.target;
      const time = input.value;
      if (time) {
        playClickSound();
      }
    }

    // === SLIDE MANAGEMENT ===
    function showSlide(slideId) {
      playClickSound();
      hideAllSlides();
      document.getElementById(slideId).classList.add('active');
      
      if (slideId === 'lihatJadwal') {
        loadCurrentWeekSchedule();
      }
    }

    function hideSlide(slideId) {
      playClickSound();
      document.getElementById(slideId).classList.remove('active');
    }

    function hideAllSlides() {
      const slides = document.querySelectorAll('.slide');
      slides.forEach(slide => slide.classList.remove('active'));
    }

    // === AGENDA MANAGEMENT ===
    function tambahAgenda() {
      const topik = document.getElementById('topik').value.trim();
      const deskripsi = document.getElementById('deskripsi').value.trim();
      const waktuMulai = document.getElementById('waktuMulai').value;
      const waktuSelesai = document.getElementById('waktuSelesai').value;
      const hari = document.getElementById('hari').value;

      if (!topik || !waktuMulai || !waktuSelesai || !hari) {
        showToast('Mohon lengkapi semua field yang wajib!', 'error');
        return;
      }

      if (waktuMulai >= waktuSelesai) {
        showToast('Waktu selesai harus lebih besar dari waktu mulai!', 'error');
        return;
      }

      const agendaData = getAgendaData();
      const currentWeek = getCurrentWeekKey();
      
      if (!agendaData[currentWeek]) {
        agendaData[currentWeek] = {};
      }
      
      if (!agendaData[currentWeek][hari]) {
        agendaData[currentWeek][hari] = [];
      }

      const newAgenda = {
        id: Date.now(),
        topik: topik,
        deskripsi: deskripsi,
        waktuMulai: waktuMulai,
        waktuSelesai: waktuSelesai,
        tanggalDibuat: new Date().toISOString()
      };

      agendaData[currentWeek][hari].push(newAgenda);
      
      // Sort by time
      agendaData[currentWeek][hari].sort((a, b) => a.waktuMulai.localeCompare(b.waktuMulai));
      
      saveAgendaData(agendaData);
      
      // Clear form
      document.getElementById('topik').value = '';
      document.getElementById('deskripsi').value = '';
      document.getElementById('waktuMulai').value = '';
      document.getElementById('waktuSelesai').value = '';
      document.getElementById('hari').value = '';
      
      showToast('✅ Agenda berhasil ditambahkan!', 'success');
      playClickSound();
    }

    function hapusAgenda(weekKey, hari, agendaId) {
      if (confirm('Yakin ingin menghapus agenda ini?')) {
        const agendaData = getAgendaData();
        if (agendaData[weekKey] && agendaData[weekKey][hari]) {
          agendaData[weekKey][hari] = agendaData[weekKey][hari].filter(agenda => agenda.id !== agendaId);
          
          // Remove empty day
          if (agendaData[weekKey][hari].length === 0) {
            delete agendaData[weekKey][hari];
          }
          
          // Remove empty week
          if (Object.keys(agendaData[weekKey]).length === 0) {
            delete agendaData[weekKey];
          }
          
          saveAgendaData(agendaData);
          loadCurrentWeekSchedule();
          showToast('🗑️ Agenda berhasil dihapus!', 'success');
        }
      }
    }

    function editAgenda(weekKey, hari, agendaId) {
      const agendaData = getAgendaData();
      const agenda = agendaData[weekKey][hari].find(a => a.id === agendaId);
      
      if (agenda) {
        const newTopik = prompt('Edit topik:', agenda.topik);
        if (newTopik !== null && newTopik.trim()) {
          agenda.topik = newTopik.trim();
          
          const newDeskripsi = prompt('Edit deskripsi:', agenda.deskripsi || '');
          if (newDeskripsi !== null) {
            agenda.deskripsi = newDeskripsi.trim();
          }
          
          saveAgendaData(agendaData);
          loadCurrentWeekSchedule();
          showToast('✏️ Agenda berhasil diperbarui!', 'success');
        }
      }
    }

    // === WEEK MANAGEMENT ===
    function getCurrentWeekKey() {
      const now = new Date();
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay() + (currentWeekOffset * 7));
      return `week_${startOfWeek.getFullYear()}_${startOfWeek.getMonth()}_${startOfWeek.getDate()}`;
    }

    function getWeekDateRange() {
      const now = new Date();
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay() + (currentWeekOffset * 7));
      
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);
      
      return {
        start: startOfWeek,
        end: endOfWeek
      };
    }

    function navigateWeek(direction) {
      currentWeekOffset += direction;
      loadCurrentWeekSchedule();
      playClickSound();
    }

    function loadCurrentWeekSchedule() {
      const weekKey = getCurrentWeekKey();
      const agendaData = getAgendaData();
      const weekData = agendaData[weekKey] || {};
      
      updateWeekInfo();
      displaySchedule(weekData, weekKey);
    }

    function updateWeekInfo() {
      const { start, end } = getWeekDateRange();
      const weekInfo = document.getElementById('currentWeekInfo');
      
      const options = { day: 'numeric', month: 'short' };
      const startStr = start.toLocaleDateString('id-ID', options);
      const endStr = end.toLocaleDateString('id-ID', options);
      
      let weekLabel = '';
      if (currentWeekOffset === 0) {
        weekLabel = 'Minggu Ini';
      } else if (currentWeekOffset === -1) {
        weekLabel = 'Minggu Lalu';
      } else if (currentWeekOffset === 1) {
        weekLabel = 'Minggu Depan';
      } else if (currentWeekOffset < 0) {
        weekLabel = `${Math.abs(currentWeekOffset)} Minggu Lalu`;
      } else {
        weekLabel = `${currentWeekOffset} Minggu Mendatang`;
      }
      
      weekInfo.innerHTML = `${weekLabel}<br><small>${startStr} - ${endStr}</small>`;
    }

    function displaySchedule(weekData, weekKey) {
      const container = document.getElementById('jadwal-container');
      const daysOrder = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
      
      if (Object.keys(weekData).length === 0) {
        container.innerHTML = `
          <div class="empty-agenda">
            Belum ada agenda untuk minggu ini.<br>
            <small>Mulai dengan membuat agenda baru!</small>
          </div>
        `;
        return;
      }
      
      let html = '';
      daysOrder.forEach(hari => {
        if (weekData[hari] && weekData[hari].length > 0) {
          html += `
            <div class="agenda-day">
              <h3>${hari}</h3>
              ${weekData[hari].map(agenda => `
                <div class="agenda-item">
                  <div class="time">${agenda.waktuMulai} - ${agenda.waktuSelesai}</div>
                  <div class="activity">
                    <strong>${agenda.topik}</strong>
                    ${agenda.deskripsi ? `<br><small>${agenda.deskripsi}</small>` : ''}
                  </div>
                  <div class="actions" style="margin-top: 10px;">
                    <button class="btn btn-small btn-warning" onclick="editAgenda('${weekKey}', '${hari}', ${agenda.id})">✏️ Edit</button>
                    <button class="btn btn-small btn-danger" onclick="hapusAgenda('${weekKey}', '${hari}', ${agenda.id})">🗑️ Hapus</button>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }
      });
      
      container.innerHTML = html;
    }

    // === THEME MANAGEMENT ===
    function showImageSelector() {
      playClickSound();
      document.getElementById('imagePopup').classList.add('active');
    }

    function closeImageSelector() {
      document.getElementById('imagePopup').classList.remove('active');
    }

    function confirmImageTheme(imageSrc) {
      selectedImageTheme = imageSrc;
      document.getElementById('previewImage').src = imageSrc;
      closeImageSelector();
      document.getElementById('confirmPopup').classList.add('active');
      playClickSound();
    }

    function applyImageTheme() {
      if (selectedImageTheme) {
        document.body.style.setProperty('--bg-image-url', `url('${selectedImageTheme}')`);
        saveBackgroundImage(selectedImageTheme);
        showToast('🎨 Tema berhasil diubah!', 'success');
      }
      cancelImageTheme();
    }

    function cancelImageTheme() {
      document.getElementById('confirmPopup').classList.remove('active');
      selectedImageTheme = '';
    }

    // === WELCOME & TUTORIAL ===
    function showWelcome() {
      document.getElementById('welcomePopup').classList.add('active');
    }

    function closeWelcome() {
      document.getElementById('welcomePopup').classList.remove('active');
      playClickSound();
    }

    function showTutorial() {
      closeWelcome();
      document.getElementById('tutorialOverlay').classList.add('active');
      playClickSound();
    }

    function closeTutorial() {
      document.getElementById('tutorialOverlay').classList.remove('active');
    }

    // === SIDEBAR MANAGEMENT ===
    function openAgendakuBranding() {
      document.getElementById('sidebarOverlay').classList.add('active');
      document.getElementById('agendakuSidebar').classList.add('active');
      playClickSound();
    }

    function closeAgendakuBranding() {
      document.getElementById('sidebarOverlay').classList.remove('active');
      document.getElementById('agendakuSidebar').classList.remove('active');
    }

    // === PDF EXPORT ===
    function showPdfConfirmPopup() {
      document.getElementById('pdfPopup').classList.add('active');
      playClickSound();
    }

    function closePdfPopup() {
      document.getElementById('pdfPopup').classList.remove('active');
      selectedPdfType = '';
    }

    function selectPdfOption(type) {
      selectedPdfType = type;
      document.getElementById(type === 'current' ? 'currentWeek' : 'allWeeks').checked = true;
      playClickSound();
    }

    function exportToPDF() {
      if (!selectedPdfType) {
        showToast('Pilih jenis export terlebih dahulu!', 'error');
        return;
      }

      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Add title
        doc.setFontSize(20);
        doc.text('📅 Agenda Saya', 20, 20);
        
        const agendaData = getAgendaData();
        let yPosition = 40;
        
        if (selectedPdfType === 'current') {
          const weekKey = getCurrentWeekKey();
          const weekData = agendaData[weekKey] || {};
          yPosition = addWeekToPDF(doc, weekData, yPosition, 'Minggu Ini');
        } else {
          Object.keys(agendaData).forEach(weekKey => {
            yPosition = addWeekToPDF(doc, agendaData[weekKey], yPosition, weekKey);
          });
        }
        
        doc.save('agendaku-export.pdf');
        showToast('📄 PDF berhasil diexport!', 'success');
        closePdfPopup();
      } catch (error) {
        showToast('❌ Gagal membuat PDF: ' + error.message, 'error');
      }
    }

    function addWeekToPDF(doc, weekData, startY, weekTitle) {
      let yPos = startY;
      
      doc.setFontSize(16);
      doc.text(weekTitle, 20, yPos);
      yPos += 15;
      
      const daysOrder = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
      
      daysOrder.forEach(hari => {
        if (weekData[hari] && weekData[hari].length > 0) {
          doc.setFontSize(14);
          doc.text(hari, 25, yPos);
          yPos += 10;
          
          weekData[hari].forEach(agenda => {
            doc.setFontSize(10);
            doc.text(`${agenda.waktuMulai} - ${agenda.waktuSelesai}: ${agenda.topik}`, 30, yPos);
            yPos += 8;
            
            if (agenda.deskripsi) {
              doc.text(`   ${agenda.deskripsi}`, 35, yPos);
              yPos += 8;
            }
          });
          yPos += 5;
        }
      });
      
      return yPos + 10;
    }

    // === PROJECT IMPORT/EXPORT ===
    function showExportPopup() {
      document.getElementById('exportPopup').classList.add('active');
      playClickSound();
    }

    function closeExportPopup() {
      document.getElementById('exportPopup').classList.remove('active');
    }

    function exportProject() {
      try {
        const agendaData = getAgendaData();
        const exportData = {
          version: '1.6',
          exportDate: new Date().toISOString(),
          data: agendaData,
          backgroundImage: getBackgroundImage()
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `agendaku-backup-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showToast('📁 Backup berhasil didownload!', 'success');
        closeExportPopup();
      } catch (error) {
        showToast('❌ Gagal membuat backup: ' + error.message, 'error');
      }
    }

    function showImportPopup() {
      document.getElementById('importPopup').classList.add('active');
      playClickSound();
    }

    function closeImportPopup() {
      document.getElementById('importPopup').classList.remove('active');
      document.getElementById('importFile').value = '';
    }

    function importProject() {
      const fileInput = document.getElementById('importFile');
      const file = fileInput.files[0];
      
      if (!file) {
        showToast('Pilih file backup terlebih dahulu!', 'error');
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importData = JSON.parse(e.target.result);
          
          if (!importData.data) {
            throw new Error('Format file tidak valid');
          }
          
          // Backup current data
          const currentData = getAgendaData();
          localStorage.setItem('agendaData_backup', JSON.stringify(currentData));
          
          // Import new data
          saveAgendaData(importData.data);
          
          if (importData.backgroundImage) {
            saveBackgroundImage(importData.backgroundImage);
            document.body.style.setProperty('--bg-image-url', `url('${importData.backgroundImage}')`);
          }
          
          showToast('📥 Data berhasil diimport!', 'success');
          closeImportPopup();
          
          // Refresh current view
          if (document.getElementById('lihatJadwal').classList.contains('active')) {
            loadCurrentWeekSchedule();
          }
        } catch (error) {
          showToast('❌ Gagal import data: ' + error.message, 'error');
        }
      };
      
      reader.readAsText(file);
    }

    // === EXIT & UPDATE ===
    function showExitConfirmPopup() {
      document.getElementById('exitPopup').classList.add('active');
      playClickSound();
    }

    function closeExitPopup() {
      document.getElementById('exitPopup').classList.remove('active');
    }

    function exitApp() {
      if (typeof Android !== "undefined") {
        Android.exitApp();
      } else {
        window.close();
      }
    }

    function openUpdateInBrowser() {
      window.open('https://andikka0001.github.io/agendaku-komersial/', '_blank');
    }

    // === UTILITY FUNCTIONS ===
    function closeAllPopups() {
      document.querySelectorAll('.popup-overlay.active, .sidebar-overlay-blur.active, #agendakuSidebar.active').forEach(el => {
        el.classList.remove('active');
      });
    }

    // === CONNECTION CHECK ===
    function cekKoneksiAwal() {
      fetch('https://andikka0001.github.io/verifikasi-web/version.txt')
        .then(response => response.text())
        .then(version => {
          console.log('Versi aplikasi terbaru:', version.trim());
          // Bisa ditambahkan logika untuk membandingkan versi
        })
        .catch(error => {
          console.log('Tidak dapat mengecek versi:', error);
        });
    }

    // === KEYBOARD SHORTCUTS ===
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey) {
        switch(e.key) {
          case 'n':
            e.preventDefault();
            showSlide('buatAgenda');
            break;
          case 's':
            e.preventDefault();
            showSlide('lihatJadwal');
            break;
          case 't':
            e.preventDefault();
            showImageSelector();
            break;
        }
      }
    });

    // === RESPONSIVE IMPROVEMENTS ===
    function handleResize() {
      const isMobile = window.innerWidth <= 768;
      // Add mobile-specific adjustments if needed
    }

    window.addEventListener('resize', handleResize);
    handleResize(); // Initial call

    // === ACCESSIBILITY IMPROVEMENTS ===
    function setupAccessibility() {
      // Add ARIA labels and roles
      const buttons = document.querySelectorAll('button');
      buttons.forEach(button => {
        if (!button.getAttribute('aria-label')) {
          button.setAttribute('aria-label', button.textContent || 'Button');
        }
      });
    }

    // Initialize accessibility on load
    document.addEventListener('DOMContentLoaded', setupAccessibility);
  </script>
</body>
</html>